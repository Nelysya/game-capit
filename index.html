<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Game Capit â€” Smooth Start</title>
  <style>
    :root{ --text:#e5e7eb; --accent:#22d3ee; --accent2:#a78bfa; }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:#0b1224;color:var(--text);font:16px/1.4 system-ui,Segoe UI,Roboto,Inter,sans-serif}
    body{background:#0b1224 url('assets/images/bg.png') center/cover no-repeat fixed;}

    .wrap{max-width:1100px;margin:0 auto;padding:16px;display:grid;grid-template-rows:auto 1fr;gap:12px;min-height:100vh}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    h1{font-size:clamp(18px,3vw,24px);margin:0;letter-spacing:.3px}
    .hud{display:flex;gap:10px;flex-wrap:wrap}
    .badge{background:#111827;border:1px solid #1f2937;border-radius:999px;padding:6px 12px;font-weight:600}
    .btns{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    button{appearance:none;border:0;border-radius:12px;padding:10px 14px;font-weight:700;letter-spacing:.3px;cursor:pointer;transition:.2s transform,.2s opacity}
    button.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#001018}
    button.secondary{background:#1f2937;color:var(--text);border:1px solid #374151}
    button.ghost{background:#ffffffcc;color:#0b1224;border:1px solid #1f2937}
    button:active{transform:scale(.98)}
    .stage{display:grid;place-items:center;min-height:calc(100vh - 120px);padding:12px 0}
    .machine{position:relative;background:linear-gradient(180deg,#0d1326,#0a0f21);border:1px solid #1f2937;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35) inset, 0 10px 30px rgba(0,0,0,.35);overflow:hidden;margin:0 auto;width:min(960px,92vw)}
    .top-bar{position:absolute;inset:0 0 auto 0;height:70px;background:linear-gradient(180deg,#0b182e,#0a1226);border-bottom:1px solid #21314d;display:flex;align-items:center;justify-content:center;z-index:5}
    .top-bar::after{content:"";position:absolute;inset:auto 10px 10px 10px;height:6px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);border-radius:999px}
    canvas{display:block;width:100%;height:auto;aspect-ratio:16/9}
    .note{opacity:.9;font-size:.9rem;margin-top:8px;text-align:center;text-shadow:0 1px 0 #000}
    .toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#111827;border:1px solid #374151;color:var(--text);padding:10px 14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.35);display:none}
    .toast.show{display:block}

    /* Splash screen */
    #startScreen {
      position: fixed;
      inset: 0;
      background: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 1;
      transition: opacity 1s ease-in-out;
    }
    #startScreen.fade-out {
      opacity: 0;
      pointer-events: none;
    }
    #startImage {
      max-width: 90%;
      max-height: 70vh;
      border-radius: 14px;
      box-shadow: 0 0 30px rgba(0,0,0,0.6);
      animation: fadeIn 1.5s ease;
    }
    #startBtn {
      margin-top: 20px;
      background: linear-gradient(90deg,#22d3ee,#a78bfa);
      border: none;
      color: #001018;
      padding: 12px 26px;
      border-radius: 12px;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      transition: transform .2s;
    }
    #startBtn:hover {transform: scale(1.05);}
    @keyframes fadeIn {
      from {opacity: 0; transform: scale(0.95);}
      to {opacity: 1; transform: scale(1);}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ðŸŽ¯ Claw Machine</h1>
      <div class="hud">
        <div class="badge" id="score">Skor: 0</div>
        <div class="badge" id="tries">Zonk: 0/3</div>
        <div class="badge" id="status">Ready!</div>
      </div>
      <div class="btns">
        <button class="primary" id="btnDrop">DROP (Spasi)</button>
        <button class="secondary" id="btnReset">Reset</button>
        <button class="ghost" id="audioBtn">ðŸ”ˆ</button>
      </div>
    </header>

    <!-- Splash Screen -->
    <div id="startScreen">
      <img src="assets/images/start.png" alt="Start Screen" id="startImage">
      <button id="startBtn">ðŸŽ® Play Game</button>
    </div>

    <section class="stage">
      <div class="machine">
        <div class="top-bar"><strong>RIAL CLAW MACHINE</strong></div>
        <canvas id="game" width="960" height="540"></canvas>
      </div>
      <div class="note"></div>
    </section>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    const $=s=>document.querySelector(s);
    const lerp=(a,b,t)=>a+(b-a)*t; const clamp=(n,min,max)=>Math.max(min,Math.min(max,n)); const rand=(min,max)=>Math.random()*(max-min)+min;
    const canvas=$('#game'); const ctx=canvas.getContext('2d');
    const W=canvas.width,H=canvas.height;
    const state={running:false,mode:'idle',score:0,msg:'Ready!'};let missCount=0;
    const ui={score:$('#score'),tries:$('#tries'),status:$('#status'),toast:$('#toast'),audioBtn:$('#audioBtn')};
    const setToast=t=>{ui.toast.textContent=t;ui.toast.classList.add('show');clearTimeout(setToast.t);setToast.t=setTimeout(()=>ui.toast.classList.remove('show'),1600);};
    const updateHUD=()=>{ui.score.textContent='Skor: '+state.score;ui.tries.textContent='Zonk: '+missCount+'/3';ui.status.textContent=state.msg;};

    const PRIZE_SRCS=['assets/images/prize1.png','assets/images/prize2.png','assets/images/prize3.png'];
    const PRIZE_IMGS=PRIZE_SRCS.map(s=>{const i=new Image();i.src=s;return i;});
    const prizeImg=()=>PRIZE_IMGS[Math.floor(Math.random()*PRIZE_IMGS.length)]||null;

    const soundCatch=new Audio('assets/audio/catch.mp3');
    const soundExtend=new Audio('assets/audio/extend.mp3');
    const bgMusic=new Audio('assets/audio/bg-music.mp3'); bgMusic.loop=true; bgMusic.volume=0.5;
    function setMuted(m){[bgMusic,soundCatch,soundExtend].forEach(a=>a.muted=m);ui.audioBtn.textContent=m?'ðŸ”‡':'ðŸ”ˆ';}
    setMuted(false);
    ui.audioBtn.addEventListener('click',e=>{e.stopPropagation();setMuted(!bgMusic.muted);});

    const groundY=H-60; const crane={x:W*0.5,y:80,dir:1,speed:2.2,width:70,arm:18,rope:60,maxDrop:groundY-90};
    const toys=[]; let tClock=0, grabbed=null;
    function spawnToys(){toys.length=0;const cols=6,rows=2;const padX=70,cellW=(W-2*padX)/cols,cellH=70;for(let r=0;r<rows;r++){for(let c=0;c<cols;c++){const cx=padX+cellW*(c+0.5)+rand(-8,8);const cy=groundY-20 - r*cellH + rand(-6,6);const speed=rand(0.6,1.2)*(Math.random()<0.5?-1:1);const phase=Math.random()*Math.PI*2;toys.push({x:cx,y:cy,baseY:cy,r:22,won:false,img:prizeImg(),vx:speed,phase,amp:3+Math.random()*2});}}}
    function moveToys(dt){const minX=70,maxX=W-70;tClock+=dt*0.05;for(const t of toys){if(t.won)continue;t.x+=t.vx*dt;if(t.x<minX){t.x=minX;t.vx=Math.abs(t.vx);}if(t.x>maxX){t.x=maxX;t.vx=-Math.abs(t.vx);}t.y=t.baseY+Math.sin(tClock+t.phase)*t.amp;if(Math.random()<0.003){t.vx*=-1;}}}
    spawnToys();

    function tryDrop(){if(!state.running)return;if(state.mode!=='idle')return;state.mode='dropping';state.msg='Drop the Claw';try{soundExtend.currentTime=0;soundExtend.play();}catch(_){ }updateHUD();}
    $('#btnDrop').addEventListener('click',tryDrop);
    $('#btnReset').addEventListener('click',()=>{state.score=0;missCount=0;state.mode='idle';state.msg='Ready!';crane.rope=60;crane.x=W*0.5;crane.dir=1;crane.speed=2.2;spawnToys();state.running=true;updateHUD();setToast('Reset! âœ¨');});
    window.addEventListener('keydown',e=>{if(e.code==='Space'){e.preventDefault();tryDrop();}});canvas.addEventListener('pointerdown',tryDrop);

    function drawBackground(){const g=ctx.createRadialGradient(W/2,H*0.4,50,W/2,H*0.6,Math.max(W,H));g.addColorStop(0,'rgba(79,70,229,.28)');g.addColorStop(1,'rgba(0,0,0,.0)');ctx.fillStyle=g;ctx.fillRect(0,0,W,H);ctx.fillStyle='rgba(13,20,41,.85)';ctx.fillRect(0,H-60,W,60);ctx.strokeStyle='#1f2a47';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(0,H-60);ctx.lineTo(W,H-60);ctx.stroke();}
    function drawToys(){for(const t of toys){if(t.won)continue;ctx.fillStyle='rgba(0,0,0,.35)';ctx.beginPath();ctx.ellipse(t.x,H-60+8,t.r*0.9,t.r*0.45,0,0,Math.PI*2);ctx.fill();const size=t.r*2;if(t.img&&t.img.complete){ctx.drawImage(t.img,t.x-size/2,t.y-size/2,size,size);}else{ctx.fillStyle='#f59e0b';ctx.beginPath();ctx.arc(t.x,t.y,t.r,0,Math.PI*2);ctx.fill();}}}
    function drawCrane(){ctx.strokeStyle='#21314d';ctx.lineWidth=8;ctx.beginPath();ctx.moveTo(40,60);ctx.lineTo(W-40,60);ctx.stroke();ctx.fillStyle='#1f2a47';ctx.fillRect(crane.x-40,60,80,22);ctx.strokeStyle='#94a3b8';ctx.lineWidth=3;ctx.beginPath();ctx.moveTo(crane.x,82);ctx.lineTo(crane.x,82+crane.rope);ctx.stroke();const cy=82+crane.rope;ctx.fillStyle='#c7d2fe';ctx.beginPath();ctx.arc(crane.x,cy,12,0,Math.PI*2);ctx.fill();ctx.strokeStyle='#c7d2fe';ctx.lineWidth=5;ctx.lineCap='round';ctx.beginPath();ctx.moveTo(crane.x,cy);ctx.lineTo(crane.x-14,cy+22);ctx.moveTo(crane.x,cy);ctx.lineTo(crane.x+14,cy+22);ctx.stroke();}
    function render(){ctx.clearRect(0,0,W,H);drawBackground();drawToys();drawCrane();}
    function update(dt){if(!state.running)return;moveToys(dt);if(state.mode==='idle'){crane.x+=crane.speed*crane.dir*dt;if(crane.x<70){crane.x=70;crane.dir=1}if(crane.x>W-70){crane.x=W-70;crane.dir=-1}}if(state.mode==='dropping'){crane.rope=clamp(crane.rope+5*dt,60,crane.maxDrop);const clawY=82+crane.rope;let hit=-1;for(let i=0;i<toys.length;i++){const t=toys[i];if(t.won)continue;const d=Math.hypot(t.x-crane.x,t.y-clawY);if(d<t.r+crane.arm){hit=i;break;}}if(clawY>=crane.maxDrop||hit!==-1){grabbed=hit!==-1?hit:null;state.mode='lifting';state.msg=grabbed!==null?'WIn !':'Zonk!';updateHUD();}}if(state.mode==='lifting'){crane.rope=clamp(crane.rope-6*dt,60,crane.maxDrop);if(grabbed!==null){const t=toys[grabbed];t.vx=0;t.x=lerp(t.x,crane.x,0.5);t.y=lerp(t.y,82+crane.rope+20,0.5);if(crane.rope<=62){t.won=true;grabbed=null;state.score+=1;state.mode='resetting';state.msg='Mantap! +1';setToast('ðŸŽ‰ WIN!');updateHUD();try{soundCatch.currentTime=0;soundCatch.play();}catch(_){}}}else{if(crane.rope<=62){missCount+=1;state.mode='resetting';setToast(`ðŸ’¤ ZONK-${missCount}/3`);updateHUD();if(missCount>=3){state.running=false;state.msg='ðŸ’¥ GAME OVER ';setToast('ðŸ’¥ GAME OVER ');updateHUD();}}}}if(state.mode==='resetting'){update._t=(update._t||0)+dt*60;if(update._t>24){update._t=0;state.mode='idle';if(state.running)state.msg='Ready!';updateHUD();}}}
    let lastT=performance.now();function frame(now){const dt=Math.max(0.5,Math.min(2.0,(now-lastT)/16.67));lastT=now;update(dt);render();requestAnimationFrame(frame);}
    updateHUD();requestAnimationFrame(frame);

    // === Splash transition ===
    const startScreen=document.getElementById('startScreen');
    const startBtn=document.getElementById('startBtn');
    startBtn.addEventListener('click',()=>{startScreen.classList.add('fade-out');setTimeout(()=>{startScreen.style.display='none';state.running=true;try{bgMusic.muted=false;bgMusic.currentTime=0;bgMusic.play().catch(()=>{});}catch(_){ }setToast('ðŸŽ® Have a Nice Play!');},1000);});
  </script>
</body>
</html>
